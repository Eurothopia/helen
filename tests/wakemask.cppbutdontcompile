#include <Arduino.h>
inline const int PIN_COUNT=11;

bool debug = true;
 uint64_t wake_mask = 0;

struct PIN_CONFIG {
  int pin;
  bool output_capable;
  bool has_pulldown;
};

/*
inline const int MATRIXMAP[KEYS_COUNT][2] = 
{{0,1}, {0,2}, {4,6}, {10,4},{7,8},
{3,8}, {3,1}, {3,2}, {6,9}, {6,2},
{1,5}, {5,2}, {5,9}, {9,3}, {8,5},
{1,10},{2,10},{9,10},{9,7}, {7,1},
{8,10}, {5,4}, {8,6},       {1,6}};
*/
inline const int PINMAP[PIN_COUNT] = {15,26,32,12,35,14,27,2,25,33,13};
inline const PIN_CONFIG PINMAP_ALT[PIN_COUNT] = {
    {15, true,  true}, //[0]
    {26, true,  true}, //[1]
    {32, true,  true}, //[2]
    {12, false, true}, //[3] output capable but will be kept this way, pulldown
    {35, false, false},//[4] input only, no pulldown
    {14, true,  true}, //[5]
    {27, true,  true}, //[6]
    {2,  true,  true}, //[7]
    {25, true,  true}, //[8]
    {33, true,  true}, //[9]
    {13, true,  true}  //[10]
};


void setup() {
  Serial.begin(115200);
  Serial.println("setting up gpio wakeup..");
/*
0,3,5,6,7,10
1,2,4,8,9




3,0,6
2,1
 */

  //5,10,6,3,7
  //9,1,2,8,4


      //OUT_HIGH: 9, 1, 2, 8, //////4!!INPUT_ONLY  
    //INPUT_PD: 5, 10, 6, 3, 7,   ON:0
    
    
  /*OUT_HIGH (indices → GPIOs): 9→GPIO33, 1→GPIO26, 2→GPIO32, 8→GPIO25
  
   INPUT_ONLY (index → GPIO): 4→GPIO35   // input-only, no pulldown
  
   INPUT_PD (indices → GPIOs): 5→GPIO14, 10→GPIO13, 6→GPIO27, 3→GPIO12, 7→GPIO2
  
   ON (index → GPIO): 0→GPIO15*/

/*1,2
 NOT 2,9
 */
  //12489
  const int OUT_HIGH[] = {PINMAP[0], PINMAP[5],PINMAP[6],PINMAP[7],PINMAP[10]};    // pins you can drive high
  const int INPUT_WAKE[] = {PINMAP[1],PINMAP[2],PINMAP[8],PINMAP[9]};  // input-only or inputs for wakeup
  const int INPUT_ONLY_WAKE[] = {PINMAP[4]};

  // Set outputs high
  for (int i=0; i<sizeof(OUT_HIGH)/sizeof(OUT_HIGH[0]); i++){
      pinMode(OUT_HIGH[i], OUTPUT);
      digitalWrite(OUT_HIGH[i], HIGH);
  }

  // Configure inputs with pull-down and wakeup on HIGH
  for (int i=0; i<sizeof(INPUT_WAKE)/sizeof(INPUT_WAKE[0]); i++){
      pinMode(INPUT_WAKE[i], INPUT_PULLDOWN);
      wake_mask |= 1ULL << INPUT_WAKE[i];//esp_sleep_enable_ext1_wakeup(1ULL << INPUT_WAKE[i], ESP_EXT1_WAKEUP_ANY_HIGH);
  }
  for (int i=0; i<sizeof(INPUT_ONLY_WAKE)/sizeof(INPUT_ONLY_WAKE[0]); i++){
      pinMode(INPUT_ONLY_WAKE[i], INPUT);
      wake_mask |= 1ULL << INPUT_ONLY_WAKE[i];//esp_sleep_enable_ext1_wakeup(1ULL << INPUT_ONLY_WAKE[i], ESP_EXT1_WAKEUP_ANY_HIGH);
  }
  //void print_wake_mask_binary() {
    if (debug) {
      Serial.print("wake_mask: ");
      Serial.print((uint32_t)(wake_mask >> 32), BIN); 
    
    //Serial.print("Wake Mask (Binary - Lower 32 bits): ");
    
      Serial.println((uint32_t)(wake_mask & 0xFFFFFFFF), BIN); 
    }
    //printWakeMaskPins(wake_mask);
//}
  //esp_sleep_enable_ext1_wakeup(wake_mask, ESP_EXT1_WAKEUP_ANY_HIGH);
  //Serial.print("setting up gpio input_only..");



}

void loop() {
  // put your main code here, to run repeatedly:
  Serial.print("GPIO STATE: ");
  Serial.print(digitalRead(PINMAP[1]));
  Serial.print(digitalRead(PINMAP[2]));
  Serial.print(digitalRead(PINMAP[8]));
  Serial.print(digitalRead(PINMAP[9]));
  //Serial.print(digitalRead(PINMAP[7]));
  Serial.println(digitalRead(PINMAP[4]));
}
